<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>WGM Master-Tool | GRÖNER SCHULZE</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style id="master-styles">
        :root {
            --wd-accent: #3b82f6; 
            --wd-blue: #3b82f6; 
            --wd-dark: #ffffff;
            --bg-body: #ffffff; 
            --bg-shell: #1e293b; 
            --card-bg: #334155;
            --icon-bg: #1e293b; 
            --label-color: #ffffff; 
            --app-width: 320px;
        }
        html, body { 
            height: 100%; margin: 0; padding: 0; background: var(--bg-body); 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        .app-shell {
            width: var(--app-width); height: 95vh; max-height: 780px;
            background: var(--bg-shell); color: #ffffff;
            display: flex; flex-direction: column; overflow: hidden;
            border-radius: 40px; position: relative; 
            box-shadow: 0 50px 100px rgba(15, 23, 42, 0.4); 
        }
        @media (max-width: 380px) { .app-shell { width: 94vw; height: 96vh; } }
        
        #login-overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(30,41,59,0.98); display: none; 
            flex-direction: column; justify-content: center; align-items: center; 
            z-index: 3000; backdrop-filter: blur(15px); 
        }
        #login-overlay .btn-action { max-width: 160px; height: 48px !important; flex: none; font-size: 0.8rem; }

        .assist-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 215px;
            background: var(--wd-accent); color: white; z-index: 2000;
            display: none; flex-direction: column; justify-content: center;
            padding: 45px 20px 20px; box-sizing: border-box;
            border-bottom: 4px solid #ffffff;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }
        .assist-overlay p { margin: 0; font-size: 0.72rem; font-weight: 700; line-height: 1.5; }

        .top-nav { display: flex; justify-content: flex-end; padding: 25px 20px 5px; height: 35px; z-index: 2500; position: relative; }
        select { background: #334155; color: white; border: 1px solid #475569; padding: 6px; border-radius: 8px; font-weight: 800; font-size: 0.65rem; outline: none; }
        
        .logo-area { text-align: center; padding: 5px 20px; height: 160px; position: relative; }
        .logo-area img { max-width: 145px; cursor: pointer; }
        .logo-area h1 { font-size: 0.85rem; letter-spacing: 0.5px; margin: 8px 0 5px; font-weight: 900; text-transform: uppercase; color: #ffffff; }
        .admin-title { font-size: 0.78rem; color: var(--wd-accent); font-weight: 900; margin-bottom: 12px; text-transform: uppercase; display: none; }
        .divider { height: 3px; background: var(--wd-accent); border-radius: 2px; width: 100%; }

        .view { display: none; flex-direction: column; padding: 10px 20px; flex: 1; overflow-y: auto; }
        .view.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { 
            background: var(--card-bg); height: 78px; border-radius: 22px; padding: 0 16px; 
            display: flex; align-items: center; gap: 14px; cursor: pointer; margin-bottom: 12px; 
            border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 12px 30px rgba(0,0,0,0.3); transition: transform 0.2s;
        }
        .icon { width: 44px; height: 44px; background: rgba(15,23,42,0.4); color: var(--wd-accent); border-radius: 14px; display: flex; align-items: center; justify-content: center; }
        .card-text h2 { margin: 0; font-size: 0.82rem; font-weight: 900; text-transform: uppercase; color: #ffffff; }
        .card-text p { margin: 2px 0 0; font-size: 0.62rem; color: #94a3b8; font-weight: 600; }

        .input-box { margin-bottom: 12px; height: 65px; position: relative; }
        .label { font-size: 0.6rem; color: var(--label-color); font-weight: 800; text-transform: uppercase; display: block; margin-bottom: 4px; }
        input, select.in-view { width: 100%; height: 42px; padding: 0 12px; border-radius: 12px; border: 2.5px solid #334155; font-size: 0.88rem; font-weight: 800; outline: none; background: #0f172a; color: white; box-sizing: border-box; }
        input:focus { border: 3.5px solid var(--wd-accent) !important; }

        .res-card { background: var(--wd-accent); height: 85px; border-radius: 22px; display: flex; flex-direction: column; justify-content: center; align-items: center; margin: 10px 0; color: white; box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4); }
        .res-num { font-size: 1.8rem; font-weight: 900; }
        .res-info { font-size: 0.58rem; font-weight: 800; text-transform: uppercase; opacity: 0.9; }

        .back-btn { color: #94a3b8; display: flex; align-items: center; gap: 4px; cursor: pointer; font-weight: 900; font-size: 0.68rem; }
        .btn-row { display: flex; gap: 10px; margin-top: 5px; height: 48px; width: 100%; align-items: center; }
        .btn-action { background: var(--wd-accent); color: white; border: none; flex: 1; border-radius: 14px; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; text-transform: uppercase; font-size: 0.58rem; height: 48px; }
        .btn-reset { width: 44px; height: 44px; border-radius: 12px; background: #1e293b; color: #94a3b8; border: 1.5px solid #334155; cursor: pointer; display: flex; align-items: center; justify-content: center; flex: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-reset:active { color: #ffffff; }

        .admin-scroll { flex: 1; overflow-y: auto; padding-right: 5px; }
        .admin-section { margin-bottom: 22px; border-bottom: 1px solid #334155; padding-bottom: 12px; }
        .admin-section h4 { font-size: 0.68rem; color: var(--wd-accent); text-transform: uppercase; margin-bottom: 10px; border-left: 3px solid var(--wd-accent); padding-left: 8px; }

        footer { text-align: center; padding: 10px 20px 25px; font-size: 0.58rem; color: #64748b; margin-top: auto; }
        footer strong { color: #ffffff; display: block; margin-bottom: 2px; }
        .footer-links a { color: var(--wd-accent); text-decoration: none; font-weight: 800; margin: 0 8px; }
    </style>
</head>
<body>

<div class="app-shell">
    <div id="assist-overlay" class="assist-overlay" onclick="toggleAssist()">
        <p id="assist-text">Wählen Sie ein Feld aus für Details.</p>
    </div>

    <div id="login-overlay">
        <h3 style="color:var(--wd-accent); font-weight:900;">ADMIN MASTER-GATE</h3>
        <input type="password" id="master-pin" placeholder="****" style="text-align:center; font-size:1.6rem; width:130px; letter-spacing:10px; margin-bottom: 25px;">
        <button class="btn-action" onclick="checkAccess()">ENTSPERREN</button>
        <p onclick="closeLogin()" style="margin-top:25px; font-size:0.6rem; cursor:pointer; font-weight:900; color:#94a3b8;">ABBRECHEN</p>
    </div>

    <div class="top-nav">
        <select id="uG" onchange="updateUI()"><option value="mm">mm</option><option value="inc">inc</option></select>
    </div>

    <div class="logo-area">
        <img src="applogo.jpg" id="logo-trigger" alt="GS TOOLS">
        <h1 id="app-title">GS Werbetechnik Tools</h1>
        <div id="admin-label" class="admin-title">Admin Toolbox</div>
        <div class="divider"></div>
    </div>

    <main id="view-main" class="view active">
        <div class="card" onclick="go('rollen')"><div class="icon"><i data-lucide="ruler"></i></div><div class="card-text"><h2 id="t-rollen_h">Rollen-Meter</h2><p id="t-rollen_p">Längen berechnen</p></div></div>
        <div class="card" onclick="go('nutzen')"><div class="icon"><i data-lucide="layout-grid"></i></div><div class="card-text"><h2 id="t-nutzen_h">Nutzen-Rechner</h2><p id="t-nutzen_p">Schnittpläne</p></div></div>
        <div class="card" onclick="go('gew')"><div class="icon"><i data-lucide="weight"></i></div><div class="card-text"><h2 id="t-gew_h">Gewichts-Rechner</h2><p id="t-gew_p">Materialgewicht</p></div></div>
        <div class="card" onclick="go('wind')"><div class="icon"><i data-lucide="wind"></i></div><div class="card-text"><h2 id="t-wind_h">Windlast-Rechner</h2><p id="t-wind_p">Statik-Check</p></div></div>
        <div class="card" onclick="go('hohl')"><div class="icon"><i data-lucide="maximize"></i></div><div class="card-text"><h2 id="t-hohl_h">Hohlsaum-Rechner</h2><p id="t-hohl_p">Banner-Zulage</p></div></div>
    </main>

    <div id="view-rollen" class="view">
        <div class="mod-header"><div class="back-btn" onclick="go('main')"><i data-lucide="chevron-left"></i> <span id="t-back_r">ZURÜCK</span></div><div class="help-btn" onclick="toggleAssist()"><i data-lucide="help-circle"></i></div></div>
        <div class="input-box"><span class="label" id="t-rD_l" data-u>Durchmesser Außen</span><input type="number" id="rD" onfocus="foc('rD')" oninput="calcR()"></div>
        <div class="input-box"><span class="label" id="t-rd_l" data-u>Kerndurchmesser</span><input type="number" id="rd" value="76" onfocus="foc('rd')" oninput="calcR()"></div>
        <div class="input-box"><span class="label" id="t-rs_l" data-u>Materialstärke</span><input type="number" id="rs" value="0.22" step="0.01" onfocus="foc('rs')" oninput="calcR()"></div>
        <div class="res-card"><span id="resR" class="res-num">0.00 m</span><span class="res-info" id="t-res_l">Material auf der Rolle</span></div>
        <div class="btn-row">
            <button class="btn-action" id="t-bt_btn" onclick="connectBT()"><i data-lucide="bluetooth"></i> <span>BT MESSCHIEBER KOPPELN</span></button>
            <button class="btn-reset" onclick="resetForm('rollen')"><i data-lucide="refresh-cw"></i></button>
        </div>
    </div>

    <div id="view-admin" class="view">
        <div class="mod-header"><div class="back-btn" onclick="go('main')"><i data-lucide="lock"></i> <span id="t-admin_exit">ADMIN VERLASSEN</span></div></div>
        <div class="admin-scroll">
            <div id="admin-global-config" class="admin-section">
                <h4>Globale DNA (V4.1.2)</h4>
                <label class="label">Hauptfarbe (Akzent)</label><input type="color" id="cfg-color" onchange="applyAdminLive()">
                <label class="label" style="margin-top:10px;">Hintergrund (Shell)</label><input type="color" id="cfg-bg-shell" onchange="applyAdminLive()">
                <label class="label" style="margin-top:10px;">Label-Farbe</label><input type="color" id="cfg-label-color" onchange="applyAdminLive()">
                <label class="label" style="margin-top:10px;">Firma</label><input type="text" id="cfg-brand" oninput="applyAdminLive()">
                <label class="label" style="margin-top:10px;">Versionsnummer</label><input type="text" id="cfg-ver-num" oninput="applyAdminLive()">
                <label class="label" style="margin-top:10px;">Impressum URL</label><input type="text" id="cfg-link1" oninput="applyAdminLive()">
                <label class="label" style="margin-top:10px;">Datenschutz URL</label><input type="text" id="cfg-link2" oninput="applyAdminLive()">
            </div>
            <div id="admin-local-config" class="admin-section">
                <h4>Modul-Texte</h4><div id="admin-fields-list"></div>
            </div>
            <button class="btn-action" style="margin-top:10px; background:#10b981;" onclick="exportMaster()"><i data-lucide="download"></i> MASTER-DATEI EXPORTIEREN</button>
        </div>
        <button class="btn-action" style="margin-top:20px;" onclick="saveDNA()">DNA VERSIEGELN (LOKAL)</button>
    </div>

    <footer id="app-footer">
        <strong id="f-brand">Gröner Schulze</strong>
        <span id="f-ver">V4.1.2 | GS-Edition</span>
        <div class="footer-links"><a id="f-l1" href="#">Impressum</a> | <a id="f-l2" href="#">Datenschutz</a></div>
    </footer>
</div>

<script id="master-script">
    let activeView = 'main', clks = 0, tmr, adminCtx = 'main', helpOn = false;
    const i18n = { de: { mainH: "GS Werbetechnik Tools", admin_exit: "ADMIN VERLASSEN", bt_btn: "BT MESSCHIEBER KOPPELN", rollen_h: "Rollen-Meter", rollen_p: "Längen berechnen", back_r: "ZURÜCK", rD_l: "Durchmesser Außen", rd_l: "Kerndurchmesser", rs_l: "Materialstärke", res_l: "Material auf der Rolle" } };

    function go(v) {
        document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
        const al = document.getElementById('admin-label'), tit = document.getElementById('app-title');
        if(v === 'admin') {
            al.innerText = (adminCtx === 'main') ? "Admin Toolbox" : "Admin " + (i18n.de[adminCtx+'_h']||"Modul");
            al.style.display = 'block'; tit.style.display = 'none'; openAdmin();
        } else { al.style.display = 'none'; tit.style.display = 'block'; }
        activeView = v; document.getElementById(v === 'admin' ? 'view-admin' : 'view-' + (v==='main'?'main':v)).classList.add('active');
        updateUI();
    }

    function updateUI() {
        if(activeView !== 'admin') document.getElementById('app-title').innerText = (activeView === 'main') ? i18n.de.mainH : (i18n.de[activeView + '_h']||"");
        if (window.lucide) lucide.createIcons();
    }

    function calcR() { 
        let D=parseFloat(document.getElementById('rD').value||0), d=parseFloat(document.getElementById('rd').value||0), s=parseFloat(document.getElementById('rs').value||0); 
        if(D && d && s) document.getElementById('resR').innerText = ((Math.PI * (Math.pow(D, 2) - Math.pow(d, 2))) / (4 * s) / 1000).toFixed(2) + " m"; 
    }

    function resetForm(v) { document.getElementById('view-' + v).querySelectorAll('input').forEach(i => i.value = i.defaultValue || ""); }
    function toggleAssist() { helpOn = !helpOn; document.getElementById('assist-overlay').style.display = helpOn ? 'flex' : 'none'; }
    function foc(id) { if(helpOn) document.getElementById('assist-text').innerText = "Eingabe erforderlich."; }

    document.getElementById('logo-trigger').addEventListener('click', () => { clks++; clearTimeout(tmr); if(clks >= 5) { document.getElementById('login-overlay').style.display='flex'; clks=0; } tmr=setTimeout(()=>clks=0, 2000); });
    function checkAccess() { if(document.getElementById('master-pin').value === "7805") { document.getElementById('login-overlay').style.display='none'; adminCtx = activeView; go('admin'); } }
    function closeLogin() { document.getElementById('login-overlay').style.display='none'; }

    function openAdmin() {
        const r = document.documentElement; const stl = getComputedStyle(r);
        document.getElementById('cfg-color').value = stl.getPropertyValue('--wd-accent').trim();
        document.getElementById('cfg-bg-shell').value = stl.getPropertyValue('--bg-shell').trim();
        document.getElementById('cfg-label-color').value = stl.getPropertyValue('--label-color').trim();
        document.getElementById('cfg-brand').value = document.getElementById('f-brand').innerText;
        document.getElementById('cfg-ver-num').value = document.getElementById('f-ver').innerText;
        document.getElementById('cfg-link1').value = document.getElementById('f-l1').href;
        document.getElementById('cfg-link2').value = document.getElementById('f-l2').href;
        const l=document.getElementById('admin-fields-list'); l.innerHTML='';
        ['rollen_h'].forEach(k=>{ if(i18n.de[k]) l.innerHTML+=`<label class="label">${k}</label><input type="text" id="cfg-${k}" value="${i18n.de[k]}" oninput="applyAdminLive()" style="margin-bottom:12px;">`; });
    }

    function applyAdminLive() {
        const r = document.documentElement;
        r.style.setProperty('--wd-accent', document.getElementById('cfg-color').value);
        r.style.setProperty('--wd-orange', document.getElementById('cfg-color').value);
        r.style.setProperty('--bg-shell', document.getElementById('cfg-bg-shell').value);
        r.style.setProperty('--label-color', document.getElementById('cfg-label-color').value);
        document.getElementById('f-brand').innerText = document.getElementById('cfg-brand').value;
        document.getElementById('f-ver').innerText = document.getElementById('cfg-ver-num').value;
        document.getElementById('f-l1').href = document.getElementById('cfg-link1').value;
        document.getElementById('f-l2').href = document.getElementById('cfg-link2').value;
        updateUI();
    }

    function saveDNA() { localStorage.setItem('gs_v412_master', JSON.stringify({ c: document.getElementById('cfg-color').value, b: document.getElementById('cfg-bg-shell').value, l: document.getElementById('cfg-label-color').value, f: document.getElementById('f-brand').innerText, v: document.getElementById('f-ver').innerText })); alert("DNA LOKAL VERSIEGELT"); }

    function exportMaster() {
        let source = document.documentElement.outerHTML;
        const brand = document.getElementById('cfg-brand').value;
        const ver = document.getElementById('cfg-ver-num').value;
        const accent = document.getElementById('cfg-color').value;
        const bg = document.getElementById('cfg-bg-shell').value;
        const label = document.getElementById('cfg-label-color').value;

        // DNA in Quellcode brennen
        source = source.replace(/--wd-accent:.*?;/, `--wd-accent: ${accent};`);
        source = source.replace(/--wd-orange:.*?;/, `--wd-orange: ${accent};`);
        source = source.replace(/--bg-shell:.*?;/, `--bg-shell: ${bg};`);
        source = source.replace(/--label-color:.*?;/, `--label-color: ${label};`);
        
        const blob = new Blob([source], { type: 'text/html' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `WGM_MASTER_${brand.replace(/\s+/g, '_')}_${ver}.html`;
        a.click();
    }

    window.onload = () => {
        const s = localStorage.getItem('gs_v412_master'); if(s) { 
            const d = JSON.parse(s); const r = document.documentElement;
            r.style.setProperty('--wd-accent', d.c); r.style.setProperty('--wd-orange', d.c); r.style.setProperty('--bg-shell', d.b); r.style.setProperty('--label-color', d.l);
            document.getElementById('f-brand').innerText = d.f; document.getElementById('f-ver').innerText = d.v; 
        }
        updateUI();
    };
</script>
</body>
</html>

